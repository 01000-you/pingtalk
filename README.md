# PingTalk (점수판 + 워치 연동)

## 앱 개요

**PingTalk**은 1:1 게임(탁구, 배드민턴 등)을 위한 점수판 앱입니다. 모바일 앱과 워치를 연동하여 편리하게 점수를 관리할 수 있습니다.

### 주요 특징
- **모바일 앱**: 직관적인 점수판 UI (HOME/AWAY 양쪽 점수 관리)
- **워치 연동**: 워치에서 간편하게 점수 조작 (+1/-1, 리셋)
- **상태 저장**: 앱 재실행 후에도 점수 유지, 최근 경기 기록 보관
- **Undo 기능**: 점수 상태 히스토리를 통한 실수 방지
- **커스터마이징**: 플레이어 이름 변경, 점수 단위/규칙 설정

### 플랫폼 지원
- **1차 배포**: Android + Wear OS
- **향후 확장**: iOS + Apple Watch

## 핵심 아키텍처

### 권한 모델
- **모바일 앱이 Authority(정답)**: 모든 점수 상태의 최종 결정권을 가짐
- **워치는 명령 전송**: 점수 변경 명령을 폰에 전송하고, 폰이 처리 후 최신 상태를 워치로 푸시

### 동기화 프로토콜
- **Command**: 워치에서 폰으로 전송되는 점수 변경 명령 (inc/dec/reset)
- **State**: 폰에서 워치로 전송되는 현재 점수 상태 (버전 관리 포함)
- **Idempotency**: 동일 commandId 중복 적용 방지
- **재연결 동기화**: 워치 재연결 시 최신 상태 자동 동기화

## 목표
- **모바일(Flutter)**: 1:1 게임 점수판(좌/우 또는 A/B), 되돌리기/리셋, 워치 연동의 "정답(Authority)"
- **웨어러블(네이티브)**:
  - **Apple Watch**: 최소 조작(+1/-1, A/B 선택, 리셋) + 현재 점수 표시
  - **Galaxy Watch (Wear OS)**: 동일

## 주요 기능

### 제품 기능
- **경기 단위 관리**
  - 새 경기 시작 / 현재 경기 종료
  - 세트(게임) 수 지원, 승리 조건 설정
- **설정(커스터마이즈)**
  - HOME/AWAY 이름 변경
  - 점수 단위(1/2), 최대 점수, 듀스 규칙
  - 오동작 방지: 되돌리기(Undo) - 점수 상태 히스토리 기록을 통한 구현
- **상태 저장**
  - 앱 재실행 후에도 점수 유지(로컬 저장)
  - 최근 경기 기록(최소: 최근 1~5개)

### 워치 연동
- **연결 상태 관리**: 연결됨/동기화됨/끊김/재연결 중/전송 실패 상태 표시
- **명령 신뢰성**: 워치 연타/오프라인 대비 command 큐잉 및 재전송
- **재연결 동기화**: 재연결 시 워치가 최신 state를 항상 받도록 보장

## 기술 스택

### 모바일 앱
- **프레임워크**: Flutter
- **언어**: Dart
- **아키텍처**: Command/State 패턴 기반 동기화

### 워치 앱
- **Wear OS**: Kotlin (Android Wear Data Layer API)
- **Apple Watch**: Swift (WatchConnectivity) - 향후 지원 예정

### 코어 로직
- **패키지**: `pingtalk_core` (순수 Dart)
  - 점수 상태 모델 (MatchState)
  - 명령 모델 (ScoreCommand)
  - 상태 리듀서 (ScoreReducer)

## 리포 구조
- `docs/`: 논의/스펙/프로토콜 문서
- `packages/pingtalk_core/`: 점수/프로토콜 **순수 Dart 코어**
- `mobile/`: Flutter 앱(점수판 UI + 워치 브리지 채널)
- `mobile/android/wear/`: Wear OS 워치 앱 모듈

## 개발 시작(필수 선행)
### 로컬 실행(Windows)
```bash
cd mobile
flutter pub get
flutter run -d windows
```

### Android 실행(에뮬레이터/실기기)
Android SDK/JDK 설정이 필요합니다. 상세는 `docs/02-개발환경설정.md`를 참고하세요.

## 문서

- [논의 정리](docs/00-논의정리.md): 제품 구성 및 기술 방향 결정 사항
- [동기화 프로토콜](docs/01-동기화프로토콜.md): 워치-폰 간 Command/State 프로토콜 상세
- [개발환경 설정](docs/02-개발환경설정.md): 개발 환경 구성 가이드
- [Wear OS 설치 흐름](docs/04-wearos-설치흐름(폰에서설치-워치동기화).md): 워치 앱 설치 및 동기화 프로세스
- [출시 준비 체크리스트](docs/05-출시준비(완성도체크리스트).md): 스토어 출시를 위한 완성도 체크리스트
- [아이콘 적용 가이드](docs/06-아이콘(모바일-워치)-적용가이드.md): 모바일 및 워치 아이콘 적용 방법
- [구글 플레이 스토어 배포 가이드](docs/07-구글플레이스토어-배포가이드.md): 구글 플레이 스토어 배포를 위한 단계별 가이드
- [스토어 리스팅 텍스트 정보](docs/08-스토어리스팅-텍스트정보.md): 구글 플레이 스토어 업로드용 텍스트 정보 (앱 이름, 설명, 카테고리)
- [개인정보처리방침](docs/09-개인정보처리방침.md): 개인정보처리방침 문서 및 웹 호스팅 가이드

