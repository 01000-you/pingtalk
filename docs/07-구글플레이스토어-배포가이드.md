# 구글 플레이 스토어 배포 가이드

이 문서는 PingBoard 앱을 구글 플레이 스토어에 배포하기 위한 단계별 가이드를 제공합니다.

## 📋 배포 전 필수 체크리스트

### 1. 앱 식별자 변경 (필수)

현재 `com.example.mobile`로 되어 있는 packageName을 고유한 값으로 변경해야 합니다.

**권장 packageName 형식**: `com.pingtalk.app` 또는 `com.[회사명].pingtalk`

### 2. 앱 이름 및 메타데이터 변경

- 앱 표시 이름: "PingBoard" 또는 원하는 이름
- 앱 설명: 스토어에 표시될 설명 문구

### 3. 릴리즈 서명 설정

- Keystore 파일 생성 및 서명 구성
- Debug 키는 스토어 배포 불가

### 4. 버전 정보

- `versionName`: 사용자에게 보이는 버전 (예: "1.0.0")
- `versionCode`: 정수형 빌드 번호 (매 배포마다 증가)

---

## 🔧 1단계: 앱 식별자 및 메타데이터 변경

### 1.1 PackageName 변경

**변경할 파일들:**

1. **`mobile/android/app/build.gradle.kts`**
   - `namespace` 변경
   - `applicationId` 변경

2. **`mobile/android/wear/build.gradle.kts`**
   - `namespace` 변경 (선택사항, 일관성 유지)
   - `applicationId` 변경 (모바일과 동일하게 유지)

3. **`mobile/android/app/src/main/AndroidManifest.xml`**
   - 패키지 참조 확인

4. **`mobile/android/wear/src/main/AndroidManifest.xml`**
   - 패키지 참조 확인

**예시 변경:**
```kotlin
// build.gradle.kts
namespace = "com.pingtalk.app"
applicationId = "com.pingtalk.app"
```

### 1.2 앱 이름 변경

**`mobile/android/app/src/main/AndroidManifest.xml`**
```xml
<application
    android:label="PingBoard"  <!-- "mobile"에서 변경 -->
    ...>
```

**`mobile/pubspec.yaml`**
```yaml
name: mobile  # 이건 내부 패키지 이름이므로 변경 불필요 (선택)
description: "PingBoard - 1:1 게임 점수판 앱"  # 설명 추가
```

---

## 🔐 2단계: 릴리즈 서명 설정

### 2.1 Keystore 생성

터미널에서 다음 명령어 실행:

```bash
cd mobile/android
keytool -genkey -v -keystore pingtalk-release-key.jks -keyalg RSA -keysize 2048 -validity 10000 -alias pingtalk
```

**입력 정보:**
- 비밀번호: 안전하게 저장 (나중에 필요)
- 이름, 조직 등: 실제 정보 입력
- 유효기간: 10000일 (약 27년)

**주의사항:**
- `pingtalk-release-key.jks` 파일은 **절대 Git에 커밋하지 마세요**
- 안전한 곳에 백업 보관 (분실 시 업데이트 불가)

### 2.2 key.properties 파일 생성

`mobile/android/key.properties` 파일 생성:

```properties
storePassword=<위에서 입력한 비밀번호>
keyPassword=<위에서 입력한 비밀번호>
keyAlias=pingtalk
storeFile=pingtalk-release-key.jks
```

**주의:** 이 파일도 `.gitignore`에 포함되어 있어야 합니다.

### 2.3 build.gradle.kts에 서명 설정 추가

**`mobile/android/app/build.gradle.kts`** 수정:

```kotlin
plugins {
    id("com.android.application")
    id("kotlin-android")
    id("dev.flutter.flutter-gradle-plugin")
}

// key.properties 파일 읽기
val keystorePropertiesFile = rootProject.file("key.properties")
val keystoreProperties = java.util.Properties()
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(java.io.FileInputStream(keystorePropertiesFile))
}

android {
    namespace = "com.pingtalk.app"
    compileSdk = flutter.compileSdkVersion
    ndkVersion = flutter.ndkVersion

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_17.toString()
    }

    defaultConfig {
        applicationId = "com.pingtalk.app"
        minSdk = flutter.minSdkVersion
        targetSdk = flutter.targetSdkVersion
        versionCode = flutter.versionCode
        versionName = flutter.versionName
    }

    signingConfigs {
        create("release") {
            keyAlias = keystoreProperties["keyAlias"] as String
            keyPassword = keystoreProperties["keyPassword"] as String
            storeFile = file(keystoreProperties["storeFile"] as String)
            storePassword = keystoreProperties["storePassword"] as String
        }
    }

    buildTypes {
        release {
            signingConfig = signingConfigs.getByName("release")
            isMinifyEnabled = false  // ProGuard는 필요시 활성화
        }
    }
}

flutter {
    source = "../.."
}

dependencies {
    implementation("com.google.android.gms:play-services-wearable:18.2.0")
}
```

### 2.4 Wear OS 모듈 서명 설정 (선택)

Wear OS 모듈도 동일한 서명을 사용하려면 `mobile/android/wear/build.gradle.kts`에도 추가할 수 있지만, Flutter 앱과 같은 applicationId를 사용하므로 모바일 앱 빌드 시 자동으로 포함됩니다.

---

## 📦 3단계: 릴리즈 빌드 생성

### 3.1 버전 정보 확인

**`mobile/pubspec.yaml`** 확인:
```yaml
version: 1.0.0+1  # versionName: 1.0.0, versionCode: 1
```

**버전 관리 규칙:**
- `versionName`: 사용자에게 보이는 버전 (예: "1.0.0", "1.1.0")
- `versionCode`: 정수 (매 배포마다 반드시 증가, 예: 1, 2, 3...)

**중요: Wear OS 버전 코드 관리**
- Play Console에서 모바일과 Wear OS가 별도 페이지로 관리되는 경우, 버전 코드 충돌을 방지하기 위해 Wear OS 버전 코드에 오프셋(1000)을 추가합니다.
- 모바일: versionCode = 1, 2, 3...
- Wear OS: versionCode = 1001, 1002, 1003... (모바일 + 1000)
- `versionName`은 모바일과 동일하게 유지합니다 (사용자에게 보이는 버전)

### 3.2 App Bundle (AAB) 빌드

구글 플레이 스토어는 APK 대신 **App Bundle (AAB)** 형식을 권장합니다.

```bash
cd mobile
flutter build appbundle --release
```

빌드된 파일 위치:
- `mobile/build/app/outputs/bundle/release/app-release.aab`

### 3.3 Wear OS AAB 빌드 (별도)

Wear OS 모듈도 별도로 빌드해야 합니다. **Google Play Store는 AAB 형식을 요구**하므로 AAB로 빌드합니다:

```bash
cd mobile/android
./gradlew :wear:bundleRelease
```

빌드된 파일 위치:
- `mobile/build/wear/outputs/bundle/release/wear-release.aab`

**중요:** 
- Wear OS AAB는 Play Console에서 모바일 앱과 함께 업로드합니다.
- Google Play Store는 2021년부터 새로운 앱 업로드 시 AAB 형식을 요구합니다.
- APK 업로드는 제한적이므로 AAB 형식 사용을 권장합니다.

---

## 🎨 4단계: 스토어 리스팅 준비

### 4.1 필수 그래픽 자산

1. **앱 아이콘**
   - 512x512px (필수)
   - 1024x1024px (권장)
   - PNG 형식, 투명 배경 없음

2. **피처 그래픽**
   - 1024x500px (필수)
   - JPG 또는 PNG

3. **스크린샷**
   - 최소 2개, 최대 8개
   - 권장 해상도: 1080x1920px (세로) 또는 1920x1080px (가로)
   - 폰용 스크린샷 필수
   - 워치용 스크린샷 (선택, 권장)

4. **Wear OS 아이콘**
   - 512x512px (워치용)

### 4.1.1 언어별/국가별 자산 설정 (현지화)

**✅ 네, 피처 그래픽, 스크린샷 등을 언어별로 다르게 설정할 수 있습니다!**

구글 플레이 콘솔은 **현지화(Localization)** 기능을 지원합니다. 각 언어별로 다음 항목들을 개별 설정할 수 있습니다:

**언어별로 설정 가능한 항목:**
- ✅ 피처 그래픽 (배너 이미지)
- ✅ 스크린샷
- ✅ 앱 이름
- ✅ 짧은 설명
- ✅ 전체 설명
- ✅ 기타 메타데이터

**설정 방법:**
1. Play Console → 앱 → 스토어 리스팅
2. 언어 추가 버튼 클릭
3. 각 언어별로 그래픽 자산과 텍스트를 업로드

**권장 전략:**
- **기본 언어**: 한국어 (한국 시장 우선)
- **추가 언어**: 영어, 중국어, 일본어 (향후 확장 시)
- 각 언어별로 문화에 맞는 이미지와 텍스트 사용

**예시:**
- 한국어: 한국 사용자에게 친숙한 UI 스크린샷
- 영어: 글로벌 사용자를 위한 영어 텍스트가 포함된 스크린샷
- 중국어: 중국 시장을 위한 현지화된 이미지

**참고:**
- 언어별로 자산을 제공하지 않으면 기본 언어의 자산이 표시됩니다
- 처음에는 기본 언어(한국어)만 준비하고, 필요에 따라 추가 언어를 점진적으로 추가하는 것을 권장합니다

### 4.2 텍스트 정보

1. **앱 이름**: "PingBoard" (최대 50자)
2. **짧은 설명**: 최대 80자
   - 예: "1:1 게임을 위한 점수판 앱. 워치와 연동하여 편리하게 점수를 관리하세요."
3. **전체 설명**: 최대 4000자
   - 주요 기능, 사용법 등 상세 설명
4. **앱 카테고리**: 스포츠 또는 유틸리티

### 4.3 개인정보처리방침 (필수)

구글 플레이 스토어는 개인정보처리방침 URL을 요구합니다.

**옵션:**
1. GitHub Pages에 정적 페이지 호스팅
2. 개인 웹사이트에 페이지 생성
3. 무료 호스팅 서비스 이용

**최소 포함 내용:**
- 수집하는 데이터 (없다면 "데이터를 수집하지 않습니다" 명시)
- 데이터 사용 목적
- 데이터 저장 위치 (로컬만 사용 시 명시)
- 연락처 정보

---

## 🚀 5단계: Play Console 설정 및 배포

### 5.1 Play Console 계정 생성

1. [Google Play Console](https://play.google.com/console) 접속
2. 개발자 등록 ($25 일회성 수수료)
3. 앱 생성

### 5.2 앱 생성 및 기본 정보 입력

1. **앱 생성**
   - 앱 이름: "PingBoard"
   - 기본 언어: 한국어
   - 앱 또는 게임: 앱
   - 무료 또는 유료: **무료** (나중에 구독 기능 추가 가능)
     - 무료 앱으로 시작하면 나중에 인앱 구매/구독 기능 추가 가능
     - 유료 앱으로 시작하면 나중에 무료로 변경 불가능하므로 무료로 시작 권장

2. **앱 액세스 권한**
   - 앱이 수집하는 데이터: 없음 (또는 실제 수집하는 데이터 명시)
   - 개인정보처리방침 URL 입력

### 5.3 프로덕션 트랙 설정

**단계별 배포 권장 순서:**

1. **내부 테스트 (Internal testing)**
   - 팀 내부 테스트용
   - 최대 100명
   - 빠른 승인 (보통 몇 시간)

2. **클로즈드 테스트 (Closed testing)**
   - 베타 테스터 그룹
   - 제한된 사용자 그룹

3. **오픈 테스트 (Open testing)**
   - 공개 베타 (선택)

4. **프로덕션 (Production)**
   - 정식 출시

**참고:** 모든 테스트 트랙(내부/클로즈드/오픈)에서도 모바일 앱과 워치 앱을 함께 업로드해야 합니다.

### 5.4 앱 번들 및 Wear OS APK 업로드

#### 5.4.1 모바일 앱 (App Bundle) 업로드

1. **프로덕션 → 새 버전 만들기** 클릭
2. **App Bundle 또는 APK** 섹션에서
   - "App Bundle 업로드" 버튼 클릭
   - `mobile/build/release/app/app-release.aab` 파일 선택 및 업로드

#### 5.4.2 Wear OS AAB 업로드

**중요:** 
- 모바일 앱과 동일한 `applicationId` (`com.pingtalk.app`)를 사용하면 자동으로 연결됩니다.
- **Google Play Store는 AAB 형식을 요구**하므로 Wear OS 앱도 AAB로 업로드해야 합니다.

**방법 1: 같은 버전 페이지에서 업로드 (권장)**

1. 모바일 앱 AAB를 업로드한 **같은 버전 페이지**에서
2. **"추가 APK 또는 App Bundle 추가"** 또는 **"기기별 App Bundle"** 섹션 확인
3. **"Wear OS용 App Bundle 추가"** 또는 **"기기 유형별 App Bundle"** 옵션 찾기
4. `mobile/build/release/wear/wear-release.aab` 파일 업로드

**방법 2: 기기별 App Bundle 섹션**

1. 버전 페이지에서 **"기기별 App Bundle"** 또는 **"Device targeting"** 섹션 확인
2. **"Wear OS"** 또는 **"Wear"** 탭 클릭
3. App Bundle 업로드

**방법 3: 자동 인식 (applicationId가 동일한 경우)**

- 모바일 앱과 워치 앱이 **동일한 applicationId** (`com.pingtalk.app`)를 사용하면
- 구글 플레이 콘솔이 자동으로 워치 앱을 인식할 수 있습니다
- 하지만 명시적으로 업로드하는 것이 권장됩니다

**참고:**
- Google Play Store는 2021년부터 새로운 앱 업로드 시 **AAB 형식을 요구**합니다
- APK 업로드는 제한적이므로 **AAB 형식 사용을 권장**합니다
- UI가 업데이트되어 위치가 다를 수 있습니다
- "Wear OS" 섹션이 보이지 않으면 "기기별 App Bundle" 또는 "Device targeting" 섹션을 확인하세요
- 같은 버전 페이지 내에서 모바일과 워치 앱을 함께 업로드해야 합니다

### 5.5 스토어 리스팅 작성

1. **그래픽 자산 업로드**
   - 아이콘, 피처 그래픽, 스크린샷

2. **텍스트 정보 입력**
   - 이름, 설명, 카테고리

3. **콘텐츠 등급**
   - 설문 작성 (일반적으로 "Everyone")

### 5.6 출시 준비 완료

1. **모든 필수 항목 체크**
   - ✅ 앱 번들 업로드
   - ✅ Wear OS APK 업로드
   - ✅ 스토어 리스팅 완료
   - ✅ 개인정보처리방침 URL
   - ✅ 콘텐츠 등급

2. **검토 제출**
   - "출시" 버튼 클릭
   - 검토 기간: 보통 1-3일

---

## 🔄 6단계: 업데이트 배포

### 6.1 버전 업데이트

**`mobile/pubspec.yaml`** 수정:
```yaml
version: 1.1.0+2  # versionName 증가, versionCode 증가
```

**`mobile/android/wear/build.gradle.kts`** 수정:
```kotlin
versionCode = 1002  // 모바일 versionCode(2) + 1000
versionName = "1.1.0"  // 모바일과 동일
```

### 6.2 빌드 및 업로드

```bash
flutter build appbundle --release
# wear 모듈도 업데이트된 경우
cd mobile/android
./gradlew :wear:bundleRelease
```

### 6.3 Play Console에서 업데이트

1. 프로덕션 → 새 버전 만들기
2. 새 AAB 업로드
3. 릴리즈 노트 작성
4. 검토 제출

---

## ⚠️ 주의사항

### PackageName 변경 시

- PackageName은 **한 번 설정하면 변경 불가**
- 신중하게 결정해야 함
- 변경하려면 새 앱으로 등록해야 함

### Keystore 관리

- Keystore 파일과 비밀번호는 **안전하게 보관**
- 분실 시 앱 업데이트 불가 (새 앱으로 재등록 필요)
- 여러 곳에 백업 권장

### Wear OS 배포

- 모바일 앱과 워치 앱은 **동일한 applicationId** 사용
- Play Console에서 자동으로 연결됨
- 워치 앱은 모바일 앱 설치 시 자동으로 동기화됨

### 테스트

- 내부 테스트부터 시작하여 점진적으로 확대
- 실제 워치 기기에서 테스트 필수
- 다양한 Android 버전에서 테스트

---

## 📚 참고 자료

- [Flutter 앱 배포 가이드](https://docs.flutter.dev/deployment/android)
- [Google Play Console 도움말](https://support.google.com/googleplay/android-developer)
- [Wear OS 앱 배포](https://developer.android.com/training/wearables/apps/packaging)
- [App Bundle 가이드](https://developer.android.com/guide/app-bundle)

---

## ✅ 배포 체크리스트

배포 전 최종 확인:

- [ ] PackageName 변경 완료 (`com.example.mobile` → 고유한 값)
- [ ] 앱 이름 변경 완료 ("mobile" → "PingBoard")
- [ ] Keystore 생성 및 서명 설정 완료
- [ ] 버전 정보 확인 (`versionName`, `versionCode`)
- [ ] 릴리즈 빌드 성공 (AAB + Wear APK)
- [ ] 스토어 리스팅 자산 준비 (아이콘, 스크린샷, 설명)
- [ ] 개인정보처리방침 URL 준비
- [ ] Play Console 계정 생성 및 앱 등록
- [ ] 내부 테스트 배포 및 검증
- [ ] 프로덕션 배포 준비 완료

