# 동기화 프로토콜(초안)

## 목표
- 워치(Apple Watch / Wear OS)가 **점수 변경 명령**을 폰으로 보내고
- 폰이 이를 적용한 뒤 **최신 상태**를 워치로 푸시한다.

## 개념
- **Command**: 사용자가 “무엇을” 했는지(증분/감소/리셋)
- **State**: 현재의 정답 점수(버전 포함)

## Command (JSON)

### 공통 필드
- `id`: 명령 ID(UUID 권장)
- `matchId`: 경기 ID(UUID 권장)
- `type`: `"inc" | "dec" | "reset"`
- `side`: `"HOME" | "AWAY"` (reset은 생략 가능)
- `issuedAt`: ISO8601
- `issuedBy`: `"watch" | "phone"`
- `deviceId`: 디바이스 식별(권장)

### 예시
```json
{
  "id": "cmd_123",
  "matchId": "match_1",
  "type": "inc",
  "side": "HOME",
  "issuedAt": "2026-01-29T10:00:00.000Z",
  "issuedBy": "watch",
  "deviceId": "apple_watch_01"
}
```

## State (JSON)

### 필드
- `matchId`
- `playerAName`, `playerBName`
- `scoreA`, `scoreB`
- `version`: 정수(상태가 바뀔 때마다 +1)
- `lastUpdatedAt`: ISO8601
- `lastUpdatedBy`: `"watch" | "phone"`

### 예시
```json
{
  "matchId": "match_1",
  "playerAName": "A",
  "playerBName": "B",
  "scoreA": 3,
  "scoreB": 2,
  "version": 7,
  "lastUpdatedAt": "2026-01-29T10:00:01.000Z",
  "lastUpdatedBy": "phone"
}
```

## 충돌/오프라인(옵션)
- 기본: **폰 Authority** → 워치는 명령만 전송(폰 미연결 시 명령 실패 또는 큐잉)
- 오프라인 지원 시:
  - 워치가 command를 큐로 저장
  - 연결되면 폰으로 순서대로 재전송
  - 폰은 적용 후 state를 되돌려줌

